---
title: "Data_EDA"
author: "Kara Wei"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggcorrplot)
library(tidyr)
library(reshape)
```

```{r}
data <- read.csv("/Users/karawei/Desktop/GRAD 3rd/ESE 527/garments_worker_productivity.csv")
data_org <- read.csv("/Users/karawei/Desktop/GRAD 3rd/ESE 527/garments_worker_productivity.csv")
data_org$department = replace(data_org$department, data_org$department=="finishing ", "finishing")
for (j in 1:length(data$department)){
  if(data$department[j]=="sweing"){data$department[j]<-1}
  else if(data$department[j]=="finishing "){data$department[j]<-2}
  else if(data$department[j]=="finishing"){data$department[j]<-2}
}

# change day of the week to number  Monday=1, Sunday=7
for (i in 1:length(data$day)){
  if(data$day[i]=="Monday"){data$day[i]<-as.integer(1)}
  else if(data$day[i]=="Tuesday"){data$day[i]<-as.integer(2)}
  else if(data$day[i]=="Wednesday"){data$day[i]<-as.integer(3)}
  else if(data$day[i]=="Thursday"){data$day[i]<-as.integer(4)}
  else if(data$day[i]=="Friday"){data$day[i]<-as.integer(5)}
  else if(data$day[i]=="Saturday"){data$day[i]<-as.integer(6)}
  else if(data$day[i]=="Sunday"){data$day[i]<-as.integer(7)}
}

# changing the date to date format
data$date <- as.Date(data$date,format="%m/%d/%Y" )

#Changing Quarter to numbers
for (k in 1:length(data$quarter)){
  if(data$quarter[k]=="Quarter1"){data$quarter[k]<-as.integer(1)}
  else if(data$quarter[k]=="Quarter2"){data$quarter[k]<-as.integer(2)}
  else if(data$quarter[k]=="Quarter3"){data$quarter[k]<-as.integer(3)}
  else if(data$quarter[k]=="Quarter4"){data$quarter[k]<-as.integer(4)}
  else if(data$quarter[k]=="Quarter5"){data$quarter[k]<-as.integer(5)}
}

sweing<-subset(data,data$department==1)
finishing<-subset(data,data$department==2)
sewingTeam01<-subset(sweing,sweing$team==1)
sewingTeam02<-subset(sweing,sweing$team==2)
sewingTeam03<-subset(sweing,sweing$team==3)
sewingTeam04<-subset(sweing,sweing$team==4)
sewingTeam05<-subset(sweing,sweing$team==5)
sewingTeam06<-subset(sweing,sweing$team==6)
sewingTeam07<-subset(sweing,sweing$team==7)
sewingTeam08<-subset(sweing,sweing$team==8)
sewingTeam09<-subset(sweing,sweing$team==9)
sewingTeam10<-subset(sweing,sweing$team==10)
sewingTeam11<-subset(sweing,sweing$team==11)
sewingTeam12<-subset(sweing,sweing$team==12)

finishingTeam01<-subset(finishing,finishing$team==1)
finishingTeam02<-subset(finishing,finishing$team==2)
finishingTeam03<-subset(finishing,finishing$team==3)
finishingTeam04<-subset(finishing,finishing$team==4)
finishingTeam05<-subset(finishing,finishing$team==5)
finishingTeam06<-subset(finishing,finishing$team==6)
finishingTeam07<-subset(finishing,finishing$team==7)
finishingTeam08<-subset(finishing,finishing$team==8)
finishingTeam09<-subset(finishing,finishing$team==9)
finishingTeam10<-subset(finishing,finishing$team==10)
finishingTeam11<-subset(finishing,finishing$team==11)
finishingTeam12<-subset(finishing,finishing$team==12)
```

We first convert all the categorical variables into dummy variables. Bause the dataset only has wip values for the sweing department, we decide to split the dataset into two subcategories -  finishing department and sweing department.

## Histograms of all numerical variables:

```{r}
par(mfrow = c(3, 4))
hist(data[["actual_productivity"]],main="Productivity Index",xlab="Productivity Index")
hist(data[["targeted_productivity"]],main="Target Productivity",xlab="Productivity Index")
hist(data[["smv"]],main="Standard Minute Value",xlab="Minutes Needed for Task")
hist(data[["over_time"]],main="Over Time",xlab="Minutes of Over Time")
hist(data[["wip"]],main="Work in Progress",xlab="Number of Unfinished Products")
hist(data[["incentive"]],main="Financial Incentive",xlab="Bangladash Taka(BDT)",breaks=200)
hist(data[["idle_time"]],main="Idle Time",xlab="Amount of Time When Production was Interrupted")
hist(data[["idle_men"]],main="Idle Workers",xlab="Number of Idle Workers When Production was Interrupted")
hist(data[["no_of_style_change"]],main="Number of Style Change",xlab="Number of Style Change")
hist(data[["no_of_workers"]],main="Number of Workers in a Team",xlab="Number of Workers in a Team")
```

We then draw he distributions of all numerical variables. From the numerical variables, we notice that there are tails for several variables:target productivity, over time, financial incentives, etc.

## We create correlation map for numerical variables above:

```{r}
correlation_matrix <- cor(data[6:14])
ggcorrplot(correlation_matrix,lab = TRUE)
```


# For sweing department:

```{r}
sweing_correlation_matrix <- cor(sweing[6:14])
ggcorrplot(sweing_correlation_matrix,lab = TRUE)
```

# For finishing department:

```{r}
finishing_correlation_matrix <- cor(finishing[,c(6:7,9:14)])
ggcorrplot(finishing_correlation_matrix,lab = TRUE)
```

Notice that lots of the values are missing here. That's because they have mostly 0 values in the sub-datset per finishing department.

## We draw box plots for all variables in original dataset:

```{r}
par(mfrow = c(3, 4))
boxplot(data[["actual_productivity"]],main="Productivity Index",xlab="Productivity Index")
boxplot(data[["targeted_productivity"]],main="Target Productivity",xlab="Productivity Index")
boxplot(data[["smv"]],main="Standard Minute Value",xlab="Minutes Needed for Task")
boxplot(data[["over_time"]],main="Over Time",xlab="Minutes of Over Time")
boxplot(data[["wip"]],main="Work in Progress",xlab="Number of Unfinished Products")
boxplot(data[["incentive"]],main="Financial Incentive",xlab="Bangladash Taka(BDT)",breaks=200)
boxplot(data[["idle_time"]],main="Idle Time",xlab="Amount of Time When Production was Interrupted")
boxplot(data[["idle_men"]],main="Idle Workers",xlab="Number of Idle Workers When Production was Interrupted")
boxplot(data[["no_of_style_change"]],main="Number of Style Change",xlab="Number of Style Change")
boxplot(data[["no_of_workers"]],main="Number of Workers in a Team",xlab="Number of Workers in a Team")
```

From the box plots, we see that most of the variables have outliers. 

```{r}
# ggplot(gather(data[,-c(1:5)]), aes(key,value)) +
# geom_boxplot() +
# facet_wrap(~key, scales = 'free') +
# labs(title = "Boxplots of all numerical variables")+
#   theme_minimal()
```


```{r}
data_no_team = data_org[,c(1:4,6:15)]
ggplot(melt(data_no_team),aes(x=department,y=value)) +
facet_wrap(~variable, scales="free") +
geom_boxplot()+
  labs(title = "Boxplots of all numerical variables by departments")+
  theme_minimal()
```

If we zoom in the box plots per department, sweing department has higher mean for must of the numerical values. For most of the numerical variables -  targeted_productivity, smv, wip, idle_time, idel_men, and no_of_style_change, no_of_workers, and actual_productivity - sweing department have higher outliers. 

```{r}
# ggplot(melt(data_org),aes(x=department)) +
# facet_wrap(~variable, scales="free") +
# geom_bar()+
#   labs(title = "Bar charts of all numerical variables by departments")+
#   theme_minimal()
```

## Create pie chart for department to see the distribution:

```{r,warning = FALSE}
counts_of_departments = c(length(data_org$department[data_org$department=="sweing"]), length(data_org$department[data_org$department=="finishing"]))
labels_of_departments = c("sweing", "finishing")
departments_pie_labels <- paste0(labels_of_departments, ", ", round(100 * counts_of_departments/sum(counts_of_departments), 2), "%")

# counts_of_quarters = c(length(data_prod$quarter[data_prod$quarter=="Quarter1"]), length(data_prod$quarter[data_prod$quarter=="Quarter2"]),length(data_prod$quarter[data_prod$quarter=="Quarter3"]), length(data_prod$quarter[data_prod$quarter=="Quarter4"]),length(data_prod$quarter[data_prod$quarter=="Quarter5"]))
# labels_of_quarters = c("Quarter1", "Quarter2","Quarter3","Quarter4","Quarter5")
# quarters_pie_labels <- paste0(labels_of_quarters, ", ", round(100 * counts_of_quarters/sum(counts_of_quarters), 2), "%")

# counts_of_days = c(length(data_prod$day[data_prod$day=="Monday"]),
# length(data_prod$day[data_prod$day=="Tuesday"]),
# length(data_prod$day[data_prod$day=="Wednesday"]),
# length(data_prod$day[data_prod$day=="Thursday"]),
# length(data_prod$day[data_prod$day=="Friday"]),
# length(data_prod$day[data_prod$day=="Saturday"]),
# length(data_prod$day[data_prod$day=="Sunday"]))
# labels_of_days = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")
# days_pie_labels <- paste0(labels_of_days, ", ", round(100 * counts_of_days/sum(counts_of_days), 2), "%")
```

```{r}
pie(counts_of_departments, labels = departments_pie_labels,main = "Pie Chart of Departments",col = rainbow(length(counts_of_departments)))
#pie(counts_of_quarters, labels = quarters_pie_labels,main = "Pie Chart of Quarters",col = rainbow(length(counts_of_quarters)))
#pie(counts_of_days, labels = days_pie_labels,main = "Pie Chart of Days",col = rainbow(length(counts_of_days)))
```

We see that sweing department has more corresponding rows than finishing. 




